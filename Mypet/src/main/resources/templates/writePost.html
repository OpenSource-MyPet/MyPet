<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyPet</title>
    <link rel="stylesheet" href="/writePost.css">
</head>
<body>
<div class="header">
    <div class="header-top">
        <div class="logo">MyPet</div>
        <div class="header-nav">
            <span class="header-nav-item">í™ˆ</span>
            <span class="header-nav-item">ì½˜í…ì¸ </span>
            <span class="header-nav-item">ì‡¼í•‘</span>
            <span class="header-nav-item active">ì»¤ë®¤ë‹ˆí‹°</span>
            <span class="header-nav-item">ì„œë¹„ìŠ¤</span>
            <span class="header-nav-item">í¬ë¦¬ì—ì´í„°</span>
        </div>
        <div class="header-actions">
            <button class="login-btn">ë¡œê·¸ì¸</button>
            <span class="menu-icon">â˜°</span>
        </div>
    </div>
</div>

<div class="container">
    <form action="/addpost" method="POST" class="write-form" id="postForm" enctype="multipart/form-data">
        <div class="form-header">
            <h1>ğŸ“„ í¬ìŠ¤íŠ¸ ì‘ì„±í•˜ê¸°</h1>
        </div>

        <div class="form-group">
            <label class="form-label" for="title">ì œëª©</label>
            <input
                    type="text"
                    id="title"
                    name="title"
                    class="form-input"
                    placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                    required
            >
        </div>

        <div class="form-group">
            <label class="form-label" for="content">ë³¸ë¬¸</label>
            <textarea
                    id="content"
                    class="form-textarea"
                    name="content"
                    placeholder="ì—¬ëŸ¬ë¶„ì˜ ì´ì•¼ê¸°ë¥¼ ììœ ë¡­ê²Œ ê³µìœ í•´ì£¼ì„¸ìš”!"
                    required
            ></textarea>
        </div>

        <div class="form-group">
            <label class="form-label">ì‚¬ì§„ ì²¨ë¶€</label>
            <div class="image-upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“·</div>
                <div class="upload-text">í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                <div class="upload-subtext">JPG, PNG í˜•ì‹ ì§€ì› (ìµœëŒ€ 10MB)</div>
            </div>
            <input
                    type="file"
                    id="imageInput"
                    accept="image/*"
                    name="file"
            >
            <div class="image-preview-container" id="previewContainer"></div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-cancel" onclick="history.back()">ì·¨ì†Œ</button>
            <button type="submit" class="btn btn-submit">ê²Œì‹œí•˜ê¸°</button>
        </div>
    </form>
</div>

<script>
    const uploadArea = document.getElementById('uploadArea');
    const imageInput = document.getElementById('imageInput');
    const previewContainer = document.getElementById('previewContainer');
    const postForm = document.getElementById('postForm');
    let selectedFiles = [];

    // ì—…ë¡œë“œ ì˜ì—­ í´ë¦­ ì´ë²¤íŠ¸
    uploadArea.addEventListener('click', () => {
        imageInput.click();
    });

    // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
    imageInput.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
    });

    // íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜
    function handleFiles(files) {
        const newFiles = Array.from(files).filter(file => {
            // ì´ë¯¸ì§€ íŒŒì¼ë§Œ í—ˆìš©
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return false;
            }
            // 10MB ì œí•œ
            if (file.size > 10 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 10MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return false;
            }
            return true;
        });

        selectedFiles = [...selectedFiles, ...newFiles];
        displayPreviews();
    }

    // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ í•¨ìˆ˜
    function displayPreviews() {
        previewContainer.innerHTML = '';

        selectedFiles.forEach((file, index) => {
            const reader = new FileReader();

            reader.onload = (e) => {
                const preview = document.createElement('div');
                preview.className = 'image-preview';
                preview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview ${index + 1}">
                        <button type="button" class="remove-image" onclick="removeImage(${index})">Ã—</button>
                    `;
                previewContainer.appendChild(preview);
            };

            reader.readAsDataURL(file);
        });
    }

    // ì´ë¯¸ì§€ ì œê±° í•¨ìˆ˜
    function removeImage(index) {
        selectedFiles.splice(index, 1);
        displayPreviews();
    }

    // í¼ ì œì¶œ ì´ë²¤íŠ¸
    postForm.addEventListener('submit', (e) => {


        const title = document.getElementById('title').value.trim();
        const content = document.getElementById('content').value.trim();

        if (!title || !content) {
            alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            e.preventDefault();
        }

        // ì‹¤ì œë¡œëŠ” ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
        console.log({
            title: title,
            content: content,
            images: selectedFiles
        });

        alert('ê²Œì‹œê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        // history.back(); // ì´ì „ í˜ì´ì§€ë¡œ ì´ë™
    });

    // ë„¤ë¹„ê²Œì´ì…˜ í•­ëª© í´ë¦­ ì´ë²¤íŠ¸
    document.querySelectorAll('.header-nav-item').forEach(item => {
        item.addEventListener('click', function() {
            document.querySelectorAll('.header-nav-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
        });
    });
</script>
</body>
</html>